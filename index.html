<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JARVIS V6 - Bootstrap Edition</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #000; color: #00d4ff; font-family: 'Courier New', monospace; overflow: hidden; }
        #video { width: 100vw; height: 100vh; object-fit: cover; position: absolute; z-index: 1; filter: brightness(0.5); }
        #canvas { position: absolute; z-index: 2; pointer-events: none; top: 0; left: 0; }
        .ui-overlay { position: absolute; z-index: 3; width: 100%; height: 100%; pointer-events: none; }
        .interactive { pointer-events: auto; } /* Para que los botones sí funcionen */
        .glass-panel { background: rgba(0, 20, 35, 0.8); border: 1px solid #00d4ff; border-radius: 10px; }
    </style>
</head>
<body>

    <video id="video" autoplay playsinline></video>
    <canvas id="canvas"></canvas>

    <div class="ui-overlay d-flex flex-column justify-content-between p-3">
        
        <div class="d-flex justify-content-between">
            <div class="glass-panel p-2 text-center">
                <small>SIMS</small><br><span id="total-sim" class="h5">0</span>
            </div>
            <div class="glass-panel p-2 text-center border-warning text-warning">
                <small>LOGS</small><br><span id="real-hits" class="h5">0</span>
            </div>
        </div>

        <div class="d-flex justify-content-center">
            <div class="glass-panel p-3 text-center interactive" style="width: 200px;">
                <label class="form-label small mb-1">DISTANCIA (M)</label>
                <input type="number" id="dist-input" class="form-control form-control-sm bg-transparent text-info border-info text-center" value="3" step="0.5" oninput="actualizarMira()">
            </div>
        </div>

        <div class="text-center">
            <h2 class="mb-3 text-shadow">PROB: <span id="prob">--</span>%</h2>
            <div class="d-grid gap-2 col-10 mx-auto interactive">
                <button id="btn-init" class="btn btn-outline-info btn-lg rounded-pill" onclick="init()">CONECTAR ÓPTICOS</button>
                <button id="btn-calc" class="btn btn-info btn-lg rounded-pill d-none" onclick="correrSimulacion()">CALCULAR TIRO</button>
                <button id="btn-hit" class="btn btn-warning btn-lg rounded-pill d-none" onclick="registrarAcierto()">LOG: ENCESTADO</button>
            </div>
        </div>

    </div>

<script>
    let totalSims = 0, realHits = 0, radius = 80;

    async function init() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: "environment", width: { ideal: 1280 } } 
            });
            document.getElementById('video').srcObject = stream;
            document.getElementById('btn-init').classList.add('d-none');
            document.getElementById('btn-calc').classList.remove('d-none');
            document.getElementById('btn-hit').classList.remove('d-none');
            actualizarMira();
            requestAnimationFrame(renderLoop);
        } catch (err) { alert("Cámara no disponible."); }
    }

    function actualizarMira() {
        let dist = parseFloat(document.getElementById('dist-input').value) || 1;
        radius = 200 / (dist + 0.5);
        if (radius < 15) radius = 15;
    }

    function renderLoop() {
        const c = document.getElementById('canvas');
        const ctx = c.getContext('2d');
        c.width = window.innerWidth; c.height = window.innerHeight;
        let cx = c.width/2, cy = c.height/2;

        ctx.clearRect(0,0,c.width,c.height);
        ctx.strokeStyle = (radius > 100) ? '#00ff00' : (radius > 40 ? '#00d4ff' : '#ff0055');
        ctx.lineWidth = 3;
        ctx.setLineDash([10, 5]);
        
        ctx.beginPath();
        ctx.arc(cx, cy, radius, 0, Math.PI*2);
        ctx.stroke();

        ctx.setLineDash([]);
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(cx-20, cy); ctx.lineTo(cx+20, cy);
        ctx.moveTo(cx, cy-20); ctx.lineTo(cx, cy+20);
        ctx.stroke();

        requestAnimationFrame(renderLoop);
    }

    function correrSimulacion() {
        let dist = parseFloat(document.getElementById('dist-input').value) || 1;
        let exitos = 0;
        const vueltas = 10000;
        let desviacion = 0.15 * dist; 

        for(let i=0; i<vueltas; i++) {
            let errorX = (Math.random() - 0.5) * desviacion;
            let errorY = (Math.random() - 0.5) * desviacion;
            if(Math.sqrt(errorX*errorX + errorY*errorY) < 0.20) exitos++;
        }
        
        document.getElementById('prob').innerText = ((exitos/vueltas)*100).toFixed(1);
        document.getElementById('total-sim').innerText = ++totalSims;
    }

    function registrarAcierto() {
        document.getElementById('real-hits').innerText = ++realHits;
    }
</script>
</body>
</html>